<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DockerExec &mdash;  1.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../static/additional.css?v=567a0223" />

  
    <link rel="shortcut icon" href="../../static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../static/jquery.js?v=5d32c60e"></script>
        <script src="../../static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../static/documentation_options.js?v=c5e1e573"></script>
        <script src="../../static/doctools.js?v=888ff710"></script>
        <script src="../../static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="E-Mail Catching" href="mailcatching.html" />
    <link rel="prev" title="Installation &amp; Update" href="install.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            
              <img src="../../static/cogs_v3_256.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Docker-Proxy-Stack</a><ul class="current">
<li class="toctree-l2"><a class="reference external" href="https://github.com/Sengorius/docker-proxy-stack">GitHub Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html">Installation &amp; Update</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">DockerExec</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#advantages">Advantages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use-dockerexec">How to use DockerExec?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#limitations-of-dockerexec">Limitations of DockerExec</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spawn-global-network-containers">Spawn global network containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-minimal-configuration-for-php">A Minimal Configuration for PHP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#headstarting-the-docker-containers">Headstarting the Docker Containers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mailcatching.html">E-Mail Catching</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrade-v2.html">Docker-Proxy-Stack Upgrade instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="multilevel-cert.html">Creating multilevel subdomain certificates</a></li>
<li class="toctree-l2"><a class="reference internal" href="spawn-examples.html">Spawn Container Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#what-is-the-docker-proxy-stack">What is the Docker-Proxy-Stack?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-does-the-proxy-stack-work">How does the Proxy-Stack work?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-to-add-projects-to-the-docker-proxy-network">How to add Projects to the Docker Proxy Network</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simple-rest/index.html">Simple REST Bundle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mezzio-messenger/index.html">Mezzio: Symfony-Messenger-Bridge</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html"></a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Docker-Proxy-Stack</a></li>
      <li class="breadcrumb-item active">DockerExec</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dockerexec">
<span id="docs-docker-proxy-dockerexec"></span><h1>DockerExec<a class="headerlink" href="#dockerexec" title="Link to this heading"></a></h1>
<p>To simplify most of the aforementioned tasks and add additional functionality for usual interactions with the
Docker-Proxy-Stack, we provice the Bash script <code class="docutils literal notranslate"><span class="pre">DockerExec</span></code>.</p>
<section id="advantages">
<h2>Advantages<a class="headerlink" href="#advantages" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Concise commands for Docker and Docker-Compose.</p></li>
<li><p>Perform additional tasks like stopping all local Docker containers or remove old image layers.</p></li>
<li><p>Update local <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code> automatically.</p></li>
<li><p>Synchronize the containers <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code> files automatically.</p></li>
<li><p>Starting up a project will print the projects domain to your command line.</p></li>
<li><p>Helps with “spawning” new global containers for the network.</p></li>
<li><p>Helps with the import of database files into running MySQL/PostgreSQL containers.</p></li>
</ol>
</section>
<section id="how-to-use-dockerexec">
<h2>How to use DockerExec?<a class="headerlink" href="#how-to-use-dockerexec" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Install and configure this project.</p></li>
<li><p>Try and follow <code class="docutils literal notranslate"><span class="pre">DockerExec</span> <span class="pre">help</span></code> for a list of commands.</p></li>
</ol>
</section>
<section id="limitations-of-dockerexec">
<h2>Limitations of DockerExec<a class="headerlink" href="#limitations-of-dockerexec" title="Link to this heading"></a></h2>
<p>At this point some variables and configuration are hard coded and have to be set manually for a new project.
You also need Bash. <code class="docutils literal notranslate"><span class="pre">/bin/sh</span></code> will not suffice.</p>
<ol class="arabic simple">
<li><p>Your projects Docker-Compose file has to have the name <code class="docutils literal notranslate"><span class="pre">docker-compose.proxy.y(a)ml</span></code>.</p>
<ul class="simple">
<li><p>Depending on your environment there can also be a <code class="docutils literal notranslate"><span class="pre">docker-compose.prod.y(a)ml</span></code> or for a single Compose file
<code class="docutils literal notranslate"><span class="pre">docker-compose.y(a)ml</span></code>. These are not suited for local dev environments.</p></li>
</ul>
</li>
<li><p>You have to provide a <code class="docutils literal notranslate"><span class="pre">.env</span></code> file in your project root to set necessary variables. A best practice would be to
have a version-controlled <code class="docutils literal notranslate"><span class="pre">.env.template</span></code> which you copy over to <code class="docutils literal notranslate"><span class="pre">.env</span></code> and customize on deployment.</p>
<ul class="simple">
<li><p>As of v2.1.0 the projects default <code class="docutils literal notranslate"><span class="pre">.env</span></code> file name can be configured in the Proxy’s <code class="docutils literal notranslate"><span class="pre">.env</span></code> configuration file</p></li>
</ul>
</li>
</ol>
</section>
<section id="spawn-global-network-containers">
<span id="docs-docker-proxy-spawn-instructions"></span><h2>Spawn global network containers<a class="headerlink" href="#spawn-global-network-containers" title="Link to this heading"></a></h2>
<p>Having the Docker-Proxy-Stack installed, you are still missing services. With its new configuration in v2, the only
container that is ensured on every init is the NGINX proxy, which will allow the basics. If you like to start a MySQL
database with your stack, you have to “spawn” and enable this container first. To do that, the
<code class="docutils literal notranslate"><span class="pre">DockerExec</span> <span class="pre">spawn</span> <span class="pre">create</span></code> should be prefered.</p>
<p>This command will ask you the mandatory question for any container that will be started on init. Just pass a name and
the docker image to do so, e.g. “mysql5” and “mysql:5.7”. By telling the process to enable the container, a soft link
will be created for you. Then hit <code class="docutils literal notranslate"><span class="pre">DockerExec</span> <span class="pre">proxy</span> <span class="pre">init</span></code> to see the result.</p>
<p>As the example above, any service container can be added to the stack. Try more databases like PostgreSQL, add a Redis
or dev tools like the Adminer. You could also add <a class="reference external" href="https://github.com/mcuadros/ofelia">Ofelia</a> for cron jobs or
<a class="reference external" href="https://hub.docker.com/r/collabora/code">Collabora</a> for editing office files. Whatever fits your needs.</p>
<p>If you need to configured the basic start of a container, e.g. with command parameters, volumes or environment
variables, just head to the Docker-Proxy-Stack installation directory, open the spawned container behind
<code class="docutils literal notranslate"><span class="pre">spawns-available/{container-name}</span></code> with an editor and change the file until it matches your setup. Don’t forget to
restart the stack.</p>
<p>As the <code class="docutils literal notranslate"><span class="pre">DockerExec</span> <span class="pre">proxy</span> <span class="pre">init</span></code> will only start the containers within the <code class="docutils literal notranslate"><span class="pre">path/to/Docker-Proxy/spawns-enabled</span></code>
directory, you can use the <code class="docutils literal notranslate"><span class="pre">DockerExec</span> <span class="pre">spawn</span> <span class="pre">enabled/disable</span> <span class="pre">{filename}</span></code> command, to link those necessary files. Keep
in mind to restart the Proxy-Stack, so the changes can take effect.</p>
</section>
<section id="a-minimal-configuration-for-php">
<span id="docs-docker-proxy-minimal-config-php"></span><h2>A Minimal Configuration for PHP<a class="headerlink" href="#a-minimal-configuration-for-php" title="Link to this heading"></a></h2>
<p>Some environment variables cannot be read from the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file and have to be manually added to the container under
<code class="docutils literal notranslate"><span class="pre">environment</span></code>. E.g. the domain name.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># docker-compose.proxy.yml</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">web</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${WEB_IMAGE}</span>
<span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${CON_PREFIX}-web</span>
<span class="w">        </span><span class="nt">env_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env</span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.:/var/www/html</span>
<span class="w">        </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">            </span><span class="nt">VIRTUAL_HOST</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-project.docker.test</span>
<span class="w">            </span><span class="nt">VIRTUAL_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">        </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php</span>
<span class="w">        </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">proxy</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>

<span class="w">    </span><span class="nt">php</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${PHP_IMAGE}</span>
<span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${CON_PREFIX}-app</span>
<span class="w">        </span><span class="nt">env_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env</span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.:/var/www/html</span>
<span class="w">        </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">    </span><span class="nt">proxy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${NETWORK}</span>
<span class="w">        </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">    </span><span class="nt">local</span><span class="p">:</span>
<span class="w">        </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># .env

# on a Windows machine
# convert windows path to linux in docker-compose
COMPOSE_CONVERT_WINDOWS_PATHS=1

# docker-compose configuration
CON_PREFIX=project # prefix name for the running docker container
PHP_IMAGE={$CONTAINER_REGISTRY}/php-fpm:8.3
WEB_IMAGE={$CONTAINER_REGISTRY}/nginx:latest
NETWORK=nginx-proxy
START_CONTAINER=project-app

### specific to your project
# MySQL configuration
MYSQL_HOST=proxy-db
MYSQL_PORT=3306
MYSQL_USER=root
MYSQL_DATABASE=my_project_db
MYSQL_ROOT_PASSWORD=root

# or PostgreSQL configuration
POSTGRES_HOST=proxy-pg
POSTGRES_PORT=5432
POSTGRES_USER=root
POSTGRES_DB=my_project_db
POSTGRES_PASSWORD=root
</pre></div>
</div>
<p>These files can be created within any current directory using the <code class="docutils literal notranslate"><span class="pre">DockerExec</span> <span class="pre">proxy</span> <span class="pre">generate</span> <span class="pre">${project-name}</span></code> command.
See <code class="docutils literal notranslate"><span class="pre">DockerExec</span> <span class="pre">help</span></code> for better usage info.</p>
</section>
<section id="headstarting-the-docker-containers">
<span id="docs-docker-proxy-headstarting-containers"></span><h2>Headstarting the Docker Containers<a class="headerlink" href="#headstarting-the-docker-containers" title="Link to this heading"></a></h2>
<p>Use the <code class="docutils literal notranslate"><span class="pre">START_CONTAINER</span></code> variable to define the container, that will be allocated with <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">exec</span> <span class="pre">-it</span></code> at the
end of a <code class="docutils literal notranslate"><span class="pre">DockerExec</span> <span class="pre">(dev|prod|proxy)</span> <span class="pre">start</span></code> command. If <code class="docutils literal notranslate"><span class="pre">START_CONTAINER=none</span></code> is set, the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">exec</span></code> will be
omitted. If not defined, it falls back to search for the first container with <code class="docutils literal notranslate"><span class="pre">-app</span></code> suffix.</p>
<p>If you like to use DockerExec commands within other shell scripts, e.g. starting multiple project with a single
execution, the start container would be blocking further commands, if the current shell is adopted by the container tty.
In this case, the variable <code class="docutils literal notranslate"><span class="pre">INTERRUPT_START_CONTAINER</span></code> will override the start container. Add an
<code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">INTERRUPT_START_CONTAINER=yes</span></code> to the top of your shell script, to prevent the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">exec</span></code> like this.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

<span class="nv">ALL_PATHS</span><span class="o">=(</span><span class="s2">&quot;/path/to/project1&quot;</span><span class="w"> </span><span class="s2">&quot;/path/to/project2&quot;</span><span class="w"> </span><span class="s2">&quot;/path/to/project3&quot;</span><span class="o">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">INTERRUPT_START_CONTAINER</span><span class="o">=</span>yes

<span class="k">for</span><span class="w"> </span>project<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ALL_PATHS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$project</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;No project found on </span><span class="nv">$project</span><span class="s2">!&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$project</span><span class="s2">/.env&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$project</span><span class="s2">/docker-compose.proxy.yaml&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Project on </span><span class="nv">$project</span><span class="s2"> is not prepared for Docker-Proxy-Stack!&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$project</span><span class="s2">&quot;</span>
<span class="w">    </span>DockerExec<span class="w"> </span>proxy<span class="w"> </span>start
<span class="k">done</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="install.html" class="btn btn-neutral float-left" title="Installation &amp; Update" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mailcatching.html" class="btn btn-neutral float-right" title="E-Mail Catching" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Sengorius.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>